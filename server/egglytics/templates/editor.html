{% load static %}
<!DOCTYPE html>
<html>

<link rel="stylesheet" href="{% static 'css/editor.css' %}">

<head>
    <title>Centered Zoom and Pan Image</title>
    <container class="toolbar">
        <button type="button" class="tools-button help-button" title="Instructions" id="open-instructions-modal">
            <span class="button-label">Controls</span> 
        </button>
        <h1 id="egg_count"> Total Eggs: 0 </h1>
    </container>


    <div id="instructions-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span> 
            <h3>Editor Shortcuts & Controls</h3>
            <div class="keyboard-panel">
                <div class="instruction-line">
                    <span class="key-hint">Q</span> - DEBUG PIXEL LOC
                </div>
                <div class="instruction-line">
                    <span class="key-hint">W</span> - MARK GRID AS DONE/UNDONE
                </div>
                <div class="instruction-line">
                    <span class="key-hint">E</span> - CREATE DOT
                </div>
                <div class="instruction-line">
                    <span class="key-hint">R</span> - REMOVE DOT
                </div>
                
                <div class="instruction-line pan-line">
                    <span class="key-hint">RMB</span> + DRAG - PAN IMAGE
                </div>
            </div>
        </div>
    </div>
    <br>
    <container class="other-tools">
        <button type="button" class="tools-button" title="Eraser">
            <img src="{% static 'img/eraser.png' %}" alt="Erase" class="button-photo">
        </button>
        <div class="toolbara">
        <!-- Dropdown toggle -->
        <button type="button" class="tools-button" id="edit-toggle" title="Annotate">
            <img src="{% static 'img/edit.png' %}" alt="Edit" class="button-photo">
        </button>

        <!-- Dropdown content (hidden by default) -->
        <div class="dropdown" id="edit-dropdown">
            <button type="button" class="tools-button" id="point-btn">
            <img src="{% static 'img/dot.png' %}" alt="point" class="button-photo">
            </button>
            <button type="button" class="tools-button" id="rect-btn">
            <img src="{% static 'img/bounding-box.png' %}" alt="bounding-box" class="button-photo">
            </button>
            <button type="button" class="tools-button">
            <img src="{% static 'img/polygon.png' %}" alt="polygon" class="button-photo">
            </button>
        </div>
        </div>
        <button type="button" class="tools-button" title="Undo" id="undo-btn">
            <img src="{% static 'img/undo.png' %}" alt="undo" class="button-photo">
        </button>
        <button type="button" class="tools-button" title="Redo">
            <!-- Flipping the undo button turns it into a redo button-->
            <img src="{% static 'img/undo.png' %}" alt="redo" class="button-photo" style="transform: rotateY(180deg);">
        </button>

        <div>
            <input type="checkbox" id="temp" name="temp" value="Show Grids"> 
            <label for="temp"> Show Grids</label>
        </div>

    </container>

    
</head>

<body>
    <div id="photo">
        <div id="zoom-wrapper">
            <img id="image" src="{% static 'uploads/' %}{{ image_name }}" alt="Zoomable Image">
            <canvas id="grid-canvas"></canvas>
            <canvas id="dot-canvas"></canvas>  
        </div>
    </div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/image_editor_handler.js' %}"></script>
<script>

    // NO there is no SYNTAX error here and NO you can not put this on image_editor_handler.js
    const points = {{ points_json|safe }};
    let total_egg_count = {{ total_eggs }};
    const image_id = {{img_id}};

    console.log("Total:egg debug: ", total_egg_count);
    $("#egg_count").text("Total Eggs: " + total_egg_count);

    $("#edit-toggle").on("click", function (e) {
        e.stopPropagation();
        $("#edit-dropdown").toggle();
    });

    // Close when clicking outside
    $(document).on("click", function (e) {
        if (!$(e.target).closest("#edit-toggle, #edit-dropdown").length) {
            $("#edit-dropdown").hide(); // <-- use .hide() instead of .toggle()
        }
    });


</script>
</body>
</html>
