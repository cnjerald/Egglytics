{% load static %}
<link href="{% static 'css/upload.css' %}" rel="stylesheet" />
<link href="{% static 'css/upload_assets/text_switch' %}" rel="stylesheet" />

<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet"/>

<!-- Please read -->
<!-- 
hidden accpet = Front end limitations of file upload
multiple tag = allows batch upload
id = myfile
-->

<div id="parent-container">
  <!-- Modal -->
  <div id="cropModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Image Cropper</h2>
        <button class="close-btn" onclick="closeCropper()">&times;</button>
      </div>

      <div class="modal-body">
        <div
          class="upload-area"
          id="uploadArea"
          onclick="document.getElementById('fileInput').click()"
        >
          <div class="no-image-text">
            <strong>Click here to upload an image</strong><br />
            or use the "Load Sample" button below
          </div>
        </div>

        <div class="cropper-section" id="cropperSection" style="display: none">
          <div class="image-container" id="imageContainer">
            <img id="cropImage" class="crop-image" alt="Image to crop" />
            <div class="crop-bars">
              <div
                class="bar bar-top"
                data-type="top"
                title="Drag to adjust top edge"
              ></div>
              <div
                class="bar bar-bottom"
                data-type="bottom"
                title="Drag to adjust bottom edge"
              ></div>
              <div
                class="bar bar-left"
                data-type="left"
                title="Drag to adjust left edge"
              ></div>
              <div
                class="bar bar-right"
                data-type="right"
                title="Drag to adjust right edge"
              ></div>
              <div class="crop-overlay" id="cropOverlay"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button
          class="btn btn-secondary"
          onclick="resetBars()"
          id="resetBtn"
          style="display: none"
        >
          Reset Bars
        </button>
        <button
          class="btn btn-secondary"
          onclick="resetImage()"
          id="resetPhotoBtn"
          style="display: none"
        >
          Reset Photo
        </button>
        <button
          class="btn btn-primary"
          onclick="performCrop()"
          id="cropBtn"
          style="display: none"
        >
          Crop Image
        </button>
        <button class="btn btn-primary" id="saveBtn" style="display: none">
          Save Image
        </button>
      </div>
    </div>
  </div>

  <div id="drop-area">
    <p>Drag & drop a file here, or click to select</p>
    <p>Max files: 15</p>
    <p>Max size per file: 20MB</p>
    <input type="file" id="myfile" hidden accept=".jpg,.jpeg,.png" multiple />
    <button type="button" onclick="$('#myfile').click()">Select File</button>

    <div
      id="progress-container"
      style="width: 50%; margin-top: 20px; display: none"
    >
      <div
        id="progress-bar"
        style="height: 20px; width: 0%; background-color: #4caf50"
      ></div>
    </div>
  </div>

  <div id="view-area">
    <div id="entry-container">
      <table id="upload-table">
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Size</th>
            <th>Micro / Macro <br />
              <label class="text-switch">
                <input type="checkbox" id="all_mode_toggle">
                <span class="text-slider">
                  <span class="text-micro">Micro</span>
                  <span class="text-macro">Macro</span>
                </span>
              </label>
            </th>
            <th>Crop</th>
              <th>
                Model
                <label class="selection">
                  <select id="all_model" class="limited-width-select">
                    <!-- populated by JS -->
                  </select>
                </label>
              </th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="submit-btn-container">
      <button type="button" id="upload-btn">Submit</button>
    </div>
  </div>

  <!-- Hidden form just to inject CSRF cookie -->
  <form style="display: none">{% csrf_token %}</form>
</div>

<script src="{% static 'js/image_upload_handler.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script src="{% static 'js/upload_crop_handler.js' %}"></script>