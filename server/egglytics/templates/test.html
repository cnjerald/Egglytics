{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Egglytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/4.1.0/openseadragon.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0; 
            font-family: system-ui, sans-serif;
            overflow: hidden;
        }



        .openseadragon-overlay {
            pointer-events: none !important;
        }
        #instructions {
            margin-bottom: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        .openseadragon-navigator {
            border-radius: 6px;
            box-shadow: 0 0 10px rgba(0,0,0,0.6);
        }

        .tools-button {
            height: 5vh;
            width: 5vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border: none;
            border-radius: 12px;               /* rounded corners */
            background-color: #f3f4f6;         /* soft gray */
            color: #333;                       /* icon/text color */
            cursor: pointer;                   /* show hand cursor */
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);  /* subtle shadow */
            transition: 
                background-color 0.2s ease,
                transform 0.15s ease,
                box-shadow 0.2s ease;          /* smooth animations */
        }

        .tools-button:hover {
            background-color: #e0e7ff;         /* soft highlight on hover */
            transform: translateY(-2px);       /* lift effect */
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .tools-button:active {
            background-color: #c7d2fe;         /* deeper press color */
            transform: translateY(0);          /* reset lift */
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .tools-button-selected{
            pointer-events: none;      /* Makes it unclickable */
            opacity: 0.6;              /* Makes it look dimmed */
            background-color: #ccc;    /* Grayed-out background */
            color: #666;               /* Duller text color */
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2); /* Gives it a pressed-in look */
            cursor: not-allowed;
        }

        .tools-button {
            display: block;             /* stack vertically */
            margin: 5px 0;
        }
        .button-photo {
            width: 70%;
            height: 70%;
            object-fit: contain;
            pointer-events: none; /* so clicks go to the button */
        }

        /* The sidebar menu */

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, sans-serif;
        }

        /* App container */
        .app {
            display: flex;
            height: 90vh;   /* ðŸ‘ˆ force full screen height */
            width: 100vw;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;       
            height: 100%;
            flex-shrink: 0;
            overflow: hidden;    
            transition: width 0.25s ease;
        }

        /* Collapsed sidebar */
        .sidebar.closed {
            width: 0;
            padding: 0;
            border: none;
        }

        /* Sidebar Icons*/
        .sidebar-controls{
            display: flex;
            justify-content: center;
            text-align: center;
        }


        /* Main area */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
            overflow: hidden;
            padding:1%;
        }

        /* Toggle button */
        .menu-btn {
            position: fixed;
            top: 12px;
            left: 12px;
            z-index: 10;
            padding: 6px 10px;
            cursor: pointer;
        }



        /* Viewer fills remaining space */
        #viewer {
            flex: 1;
            width: 100%;
            background: black;
            cursor: crosshair !important;
        }

        .annotation-list {
            list-style: none;          /* remove bullets */
            padding: 0;
            margin: 10px 0;
            max-height: 75vh; /* REMINDER TO JERALD(SELF) CHANGE THIS */
            overflow-y: auto;
        }

        .annotation-list li {
            background: #BFDBF7;       /* dark box */
            color: #000000;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 8px 10px;
            margin-bottom: 6px;

            font-size: 14px;
            cursor: pointer;

            transition: background 0.2s ease, border 0.2s ease;
        }

        .annotation-list li:hover {
            background: #c7d2fe;
            border-color: #000000;     /* highlight on hover */
        }



    </style>
</head>
<body>

<button id="sidebarToggle" class="menu-btn">â˜°</button>

<div class="app">
    <aside id="sidebar" class="sidebar">
        <h3>
            Current Mode:
            <span id="current-mode" style="color:#6cff6c;">Point</span>
        </h3>
        <h3>Tools</h3>

        <div class = "sidebar-controls">
            <button type="button" class="tools-button" id="point-btn">
                <img src="{% static 'img/dot.png' %}" alt="point" class="button-photo">
            </button>

            <button type="button" class="tools-button" id="rect-btn">
                <img src="{% static 'img/bounding-box.png' %}" alt="bounding-box" class="button-photo">
            </button>

            <button type="button" class="tools-button" id="grid-btn">
                <img src="{% static 'img/grid.png' %}" alt="grids" class="button-photo">
            </button>
        </div>


        <div class="sidebar-controls">
            <input type="checkbox" id="points" checked>
            <label for="points"> Points </label><br>

            <input type="checkbox" id="rectangles" checked>
            <label for="rectangles"> Rectangles </label><br>

            <input type="checkbox" id="grids">
            <label for="grids"> Grids </label><br>
        </div>

        <div>
            <h4>Annotations</h4>
            <ul id="annotation-list" class="annotation-list"></ul>
        </div>
    </aside>

    <!-- âœ… MAIN WRAPPER -->
    <main class="main">
        <!-- optional top controls later -->

        <!-- âœ… viewer lives here -->

        <div id="viewer"
            data-image-url="{% static 'uploads/' %}{{ image_name }}">
        </div>
    </main>
</div>


<!-- LOAD VARIABLES (No Syntax error here.) -->
<script>
    window.points = {{ points_json|safe }};
    let total_egg_count = {{ total_eggs }};
    const image_id = {{img_id}};
    console.log(points);
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/image_editor.js' %}"></script>


<!-- For sidebar -->
<script>
    const sidebar = document.getElementById("sidebar");
    const toggleBtn = document.getElementById("sidebarToggle");

    toggleBtn.addEventListener("click", () => {
        sidebar.classList.toggle("closed");
    });
    document.addEventListener('contextmenu', event => event.preventDefault());
</script>






</body>
</html>